jarque.bera.test(residuales_Dummy_ts)
Box.test(residuales_Dummy_ts,lag = 20,type = "Ljung")
t.test(residuales_Dummy_ts)
###Cusums
res=residuales_Dummy_ts
cum=cumsum(res)/sd(res)
N=length(res)
cumq=cumsum(res^2)/sum(res^2)
Af=0.948 ###Cuantil del 95% para la estad?stica cusum
co=0.12010####Valor del cuantil aproximado para cusumsq para n/2
LS=Af*sqrt(N)+2*Af*c(1:length(res))/sqrt(N)
LI=-LS
LQS=co+(1:length(res))/N
LQI=-co+(1:length(res))/N
#par(mfrow=c(2,1))
plot(cum,type="l",ylim=c(min(LI),max(LS)),xlab="t",ylab="",main="CUSUM")
lines(LS,type="S",col="red")
lines(LI,type="S",col="red")
#CUSUMSQ
plot(cumq,type="l",xlab="t",ylab="",main="CUSUMSQ")
lines(LQS,type="S",col="red")
lines(LQI,type="S",col="red")
###Without box-cox
fitted_final_models<-Suicides_tsbl%>%model(
`Fourier1Suic`=ARIMA(tasa_global~fourier(K=1)+pdq(0, 1, 1) + PDQ(0, 0, 0)),
`Fourier2Suic`=ARIMA(tasa_global~fourier(K=2)+pdq(0, 1, 1) + PDQ(0, 0, 0)),
`Fourier3Suic`=ARIMA(tasa_global~fourier(K=3)+pdq(0, 1, 1) + PDQ(0, 0, 0)),
`DummySuic`=ARIMA(tasa_global~season()+pdq(0, 1, 1) + PDQ(0, 0, 0))
)
glance(fitted_final_models)
fitted_final_models %>%
dplyr::select(Fourier3Suic)%>%coef()
fitted_final_models %>%
dplyr::select(DummySuic)%>%coef()
resid_DummySuic<-fitted_final_models %>%
dplyr::select(DummySuic)%>%residuals()
resid_DummySuic%>%autoplot()
residuales<-resid_DummySuic%>%dplyr::select(".resid")%>%drop_na()
residuales_Dummy_ts<-ts(residuales$.resid,start = c(year_inic,1),frequency = 12)
acf(residuales_Dummy_ts)
pacf(residuales_Dummy_ts)
plot(residuales_Dummy_ts)
jarque.bera.test(residuales_Dummy_ts)
Box.test(residuales_Dummy_ts,lag = 20,type = "Ljung")
t.test(residuales_Dummy_ts)
###Cusums
res=residuales_Dummy_ts
cum=cumsum(res)/sd(res)
N=length(res)
cumq=cumsum(res^2)/sum(res^2)
Af=0.948 ###Cuantil del 95% para la estad?stica cusum
co=0.12010####Valor del cuantil aproximado para cusumsq para n/2
LS=Af*sqrt(N)+2*Af*c(1:length(res))/sqrt(N)
LI=-LS
LQS=co+(1:length(res))/N
LQI=-co+(1:length(res))/N
#par(mfrow=c(2,1))
plot(cum,type="l",ylim=c(min(LI),max(LS)),xlab="t",ylab="",main="CUSUM")
lines(LS,type="S",col="red")
lines(LI,type="S",col="red")
#CUSUMSQ
plot(cumq,type="l",xlab="t",ylab="",main="CUSUMSQ")
lines(LQS,type="S",col="red")
lines(LQI,type="S",col="red")
library(readxl)
library(sf)
library(ggplot2)
help(st_read)
Municipios <- readRDS("Municipios.RDS")
setwd("/Users/sergiocalderon/Documents/GitHub/EstadisticaParaGeografosUN/Estadistica_Descriptiva/Mapas")
Municipios <- readRDS("Municipios.RDS")
Ocupados_ENH <- read_excel("Ocupados_ENH.xlsx",
col_types = c("text", "text", "text",
"numeric", "numeric", "numeric"))
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
#Mapa del Indice de Ruralidad Departamentos ----
deptos <- Municipios %>%
group_by(Departamento,Dep) %>%
summarise(Irural=sum(Poblacion*Irural)/sum(Poblacion)) %>%
as.data.frame()
str(deptos)
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)
str(deptoshp)
mapdeptos <- deptoshp %>% left_join(deptos,by=c("DPTO_CCDGO"="Dep"))
str(mapdeptos)
mapdeptos_Ing <- deptoshp %>% left_join(Media_Ing,by=c("DPTO_CCDGO"="DPTO"))
str(mapdeptos)
mundoshp <- st_read("admin00.shp",quiet=TRUE)
mundocol <- mundoshp %>%
filter(CNTRY_NAME %in% c("Peru","Brazil","Venezuela","Ecuador","Panama"))
str(mundocol)
help(geom_sf)
box <- st_bbox(mapdeptos)
box
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos,aes(fill=Irural),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos,aes(label=ifelse(Irural > 70,Departamento,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
Ocupados_ENH
?summarise
Ocupados_ENH$P6440
Ocupados_ENH$P6440=="1"
which(Ocupados_ENH$P6440=="1")
sum(which(Ocupados_ENH$P6440=="1"))
count(which(Ocupados_ENH$P6440=="1"))
n(which(Ocupados_ENH$P6440=="1"))
length(which(Ocupados_ENH$P6440=="1"))
Media_Ing_Prop_Contrat<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO),Prop_Contr=length(which(Ocupados_ENH$P6440=="1"))/length(Ocupados_ENH$P6440))
Media_Ing_Prop_Contrat
Ocupados_ENH%>%group_by(DPTO)
?n()
Ocupados_ENH
Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO),Prop_Contr=n(P6440))
Media_Ing_Prop_Contrat<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO),Prop_Contr=n())
Media_Ing_Prop_Contrat
Ocupados_ENH%>%group_by(DPTO)
Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO),Prop_Contr=n())
?summarise_if
Ocupados_ENH%>%group_by(DPTO)%>%select(DPTO,P6440)%>%summarise(Prop_Contr=n())
?select
Ocupados_ENH%>%group_by(DPTO)
Ocupados_ENH%>%group_by(DPTO)%>%select(DPTO,P6440)
Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)
Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%summarise(Prop_Contr=n())
length(Ocupados_ENH$P6440=="1")
length(which(Ocupados_ENH$P6440=="1"))
?n()
?cur_group_id
-Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%count(P6440)
-Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%dplyr::count(P6440)
length(which(Ocupados_ENH$P6440=="1"))
which(Ocupados_ENH$P6440=="1")
Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%summarise(Prop_Contr=n())
Prop_Contrat<-Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%summarise(Prop_Contr=n())
Ocupados_ENH$P6440
class(Ocupados_ENH$P6440)
mtcars
mtcars%>%group_by(am,gear)
mtcars%>%group_by(am,gear)%>%summarise(n=n())
Ocupados_ENH%>%group_by(DPTO)%>%dplyr::select(DPTO,P6440)%>%summarise(n())
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n())
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n())
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n())%>%
mutate(freq = n / sum(n))
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%group_by(DPTO,P6440)
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%group_by(DPTO)
?filter()
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%select(DPTO,freq)
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)
Prop_Contrat.1
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq="freq.1")
Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
Prop_Contrat.1
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
Prop_Contrat.2<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="2")%>%dplyr::select(DPTO,freq)%>%rename(freq.2="freq")
Prop_Contrat.1
Prop_Contrat.2
Media_Ing
Prop_Contrat.1
Media_ING_Prop_Contract<-Media_Ing%>%left_join(Prop_Contrat.1,by=c("DPTO"="DPTO"))
?left_join
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
Prop_Contrat.2<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="2")%>%dplyr::select(DPTO,freq)%>%rename(freq.2="freq")
Media_ING_Prop_Contract<-Media_Ing%>%left_join(Prop_Contrat.1,by=c("DPTO"="DPTO"))%>%left_join(Prop_Contrat.2,by=c("DPTO"="DPTO"))
Media_ING_Prop_Contract
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)
str(deptoshp)
mapdeptos <- deptoshp %>% left_join(deptos,by=c("DPTO_CCDGO"="Dep"))
mapdeptos_Ing <- deptoshp %>% left_join(Media_ING_Prop_Contract,by=c("DPTO_CCDGO"="DPTO"))
str(mapdeptos)
mapdeptos_Ing_Prop <- deptoshp %>% left_join(Media_ING_Prop_Contract,by=c("DPTO_CCDGO"="DPTO"))
mapdeptos_Ing_Prop
library(readxl)
library(sf)
library(ggplot2)
help(st_read)
Municipios <- readRDS("Municipios.RDS")
Ocupados_ENH <- read_excel("Ocupados_ENH.xlsx",
col_types = c("text", "text", "text",
"numeric", "numeric", "numeric"))
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
Prop_Contrat.2<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="2")%>%dplyr::select(DPTO,freq)%>%rename(freq.2="freq")
Media_ING_Prop_Contract<-Media_Ing%>%left_join(Prop_Contrat.1,by=c("DPTO"="DPTO"))%>%left_join(Prop_Contrat.2,by=c("DPTO"="DPTO"))
deptos <- Municipios %>%
group_by(Departamento,Dep) %>%
summarise(Irural=sum(Poblacion*Irural)/sum(Poblacion)) %>%
as.data.frame()
str(deptos)
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)
str(deptoshp)
mapdeptos <- deptoshp %>% left_join(deptos,by=c("DPTO_CCDGO"="Dep"))
str(mapdeptos)
mapdeptos_Ing_Prop <- deptoshp %>% left_join(Media_ING_Prop_Contract,by=c("DPTO_CCDGO"="DPTO"))
str(mapdeptos)
mapdeptos_Ing_Prop
mundoshp <- st_read("admin00.shp",quiet=TRUE)
mundocol <- mundoshp %>%
filter(CNTRY_NAME %in% c("Peru","Brazil","Venezuela","Ecuador","Panama"))
str(mundocol)
help(geom_sf)
box <- st_bbox(mapdeptos)
box
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos,aes(fill=Irural),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos,aes(label=ifelse(Irural > 70,Departamento,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
####Con Ingreso Laboral ----
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos_Ing_Prop,aes(fill=Media_Ing),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos_Ing_Prop,aes(label=ifelse(Media_Ing < 1300000,DPTO_CNMBR,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Ingreso promedio Laboral") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
mapdeptos_Ing_Prop
####Con Proporción Contrato Laboral ----
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos_Ing_Prop,aes(fill=freq.1),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos_Ing_Prop,aes(label=ifelse(freq.1 > 0.5,DPTO_CNMBR,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Proporción Contrato Laboral") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
####Con Proporción Contrato Laboral ----
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos_Ing_Prop,aes(fill=freq.1),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos_Ing_Prop,aes(label=ifelse(freq.1 > 0.5,DPTO_CNMBR,"")),col="black",
fontface="bold",size=2,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Proporción Contrato Laboral") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
###Departamento Cundinamarca por municipios ----
mpioshp <- st_read("MGN_MPIO_POLITICO.shp",quiet=TRUE)
str(mpioshp)
cund <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Dep=="25" | Dep=="11")
str(cund)
ggplot() +
geom_sf(data=cund,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=cund,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Cundinamarca",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
ggplot() +
geom_sf(data=cund,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=cund,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=2,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Cundinamarca",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
datos <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Dep=="05")
Deps <- unique(datos$Departamento)
ggplot() +
geom_sf(data=datos,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=datos,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title=ifelse(length(Deps)==1,Deps,paste0(Deps,collapse=" y ")),
fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
##Antioquia por Municipios ----
datos <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Dep=="05")
Deps <- unique(datos$Departamento)
ggplot() +
geom_sf(data=datos,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=datos,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title=ifelse(length(Deps)==1,Deps,paste0(Deps,collapse=" y ")),
fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
Llano <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Region=="Región Llano")
box <- st_bbox(Llano)
ggplot() +
geom_sf(data=Llano,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf(data=deptoshp,alpha=0.1,col="black") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=Llano,aes(label=ifelse(Irural > 85,Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Región Llano",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
###Boyacá Estaciones de Monitoreo Precipitación ----
Estaciones <- read_excel("Estaciones.xlsx")
Estaciones <- within(Estaciones,Depmun <- str_sub(Depmun,1,5))
Estaciones
Estaciones <- within(Estaciones,Depmun <- str_sub(Depmun,1,5))
??str_sub
###Boyacá Estaciones de Monitoreo Precipitación ----
library(stringr)
Estaciones <- within(Estaciones,Depmun <- stringr::str_sub(Depmun,1,5))
Estaciones
str(Estaciones)
poligonos <- mpioshp %>% filter(DPTO_CCDGO %in% c("15"))
Ests <- Estaciones %>% filter(str_sub(Depmun,1,2) %in% c("15"))
Deps <- unique(poligonos$DPTO_CNMBR)
ggplot(Ests) +
geom_sf(data=poligonos,fill="orange",col="black",linetype="solid") +
geom_point(aes(x=longitud,y=latitud,size=PRECIP),col="blue") +
scale_size(range=c(0,5)) +
labs(x="Longitud",y="Latitud",title=ifelse(length(Deps)==1,Deps,paste0(Deps,collapse=" y ")),
size="Precipitación") +
coord_sf(default_crs = sf::st_crs(4326))
library(readxl)
library(sf)
library(ggplot2)
Municipios <- readRDS("Municipios.RDS")
Ocupados_ENH <- read_excel("Ocupados_ENH.xlsx",
col_types = c("text", "text", "text",
"numeric", "numeric", "numeric"))
View(Ocupados_ENH)
View(Ocupados_ENH)
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
View(Prop_Contrat.1)
Prop_Contrat.2<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="2")%>%dplyr::select(DPTO,freq)%>%rename(freq.2="freq")
View(Prop_Contrat.2)
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
View(Media_Ing)
Media_ING_Prop_Contract<-Media_Ing%>%left_join(Prop_Contrat.1,by=c("DPTO"="DPTO"))%>%left_join(Prop_Contrat.2,by=c("DPTO"="DPTO"))
View(Media_ING_Prop_Contract)
library(readxl)
library(sf)
library(ggplot2)
Municipios <- readRDS("Municipios.RDS")
View(Municipios)
Ocupados_ENH <- read_excel("Ocupados_ENH.xlsx",
col_types = c("text", "text", "text",
"numeric", "numeric", "numeric"))
View(Ocupados_ENH)
Media_Ing<-Ocupados_ENH%>%group_by(DPTO)%>%summarise(Media_Ing=mean(INGLABO))
View(Media_Ing)
Prop_Contrat.1<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="1")%>%dplyr::select(DPTO,freq)%>%rename(freq.1="freq")
Prop_Contrat.2<-Ocupados_ENH%>%group_by(DPTO,P6440)%>%summarise(n=n())%>%
mutate(freq = n / sum(n))%>%filter(P6440=="2")%>%dplyr::select(DPTO,freq)%>%rename(freq.2="freq")
View(Prop_Contrat.1)
View(Prop_Contrat.2)
Media_ING_Prop_Contract<-Media_Ing%>%left_join(Prop_Contrat.1,by=c("DPTO"="DPTO"))%>%left_join(Prop_Contrat.2,by=c("DPTO"="DPTO"))
View(Media_ING_Prop_Contract)
deptos <- Municipios %>%
group_by(Departamento,Dep) %>%
summarise(Irural=sum(Poblacion*Irural)/sum(Poblacion)) %>%
as.data.frame()
str(deptos)
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)
deptoshp <- st_read("MGN_DPTO_POLITICO.shp",quiet=TRUE)
str(deptoshp)
mapdeptos <- deptoshp %>% left_join(deptos,by=c("DPTO_CCDGO"="Dep"))
str(mapdeptos)
mapdeptos_Ing_Prop <- deptoshp %>% left_join(Media_ING_Prop_Contract,by=c("DPTO_CCDGO"="DPTO"))
View(mapdeptos_Ing_Prop)
str(mapdeptos)
mundoshp <- st_read("admin00.shp",quiet=TRUE)
mundocol <- mundoshp %>%
filter(CNTRY_NAME %in% c("Peru","Brazil","Venezuela","Ecuador","Panama"))
str(mundocol)
help(geom_sf)
box <- st_bbox(mapdeptos)
box
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos,aes(fill=Irural),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos,aes(label=ifelse(Irural > 70,Departamento,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos,aes(fill=Irural),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos,aes(label=ifelse(Irural > 70,Departamento,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
####Con Ingreso Laboral ----
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos_Ing_Prop,aes(fill=Media_Ing),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos_Ing_Prop,aes(label=ifelse(Media_Ing < 1300000,DPTO_CNMBR,"")),col="black",
fontface="bold",size=4,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Ingreso promedio Laboral") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
####Con Proporción Contrato Laboral ----
ggplot() +
geom_sf(data=mundocol) +
geom_sf(data=mapdeptos_Ing_Prop,aes(fill=freq.1),col="darkgray",linetype="solid") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=mapdeptos_Ing_Prop,aes(label=ifelse(freq.1 > 0.5,DPTO_CNMBR,"")),col="black",
fontface="bold",size=2,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Colombia",fill="Proporción Contrato Laboral") +
scale_fill_gradient(low="white",high="red",n.breaks=5) +
annotate("text", x=c(-74.5,-68,-78,-69,-78.5), y=c(-2.5,0,-1,9,9), colour="blue",
label=c("Perú","Brasil","Ecuador","Venezuela","Panamá")) +
theme(panel.background=element_rect(fill="lightblue"))
###Departamento Cundinamarca por municipios ----
mpioshp <- st_read("MGN_MPIO_POLITICO.shp",quiet=TRUE)
str(mpioshp)
cund <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Dep=="25" | Dep=="11")
ggplot() +
geom_sf(data=cund,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=cund,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=2,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Cundinamarca",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
##Antioquia por Municipios ----
datos <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Dep=="05")
Deps <- unique(datos$Departamento)
ggplot() +
geom_sf(data=datos,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf_text(data=datos,aes(label=ifelse(Irural > quantile(Irural,0.95),Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title=ifelse(length(Deps)==1,Deps,paste0(Deps,collapse=" y ")),
fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
View(Municipios)
Llano <- mpioshp %>%
left_join(Municipios,by=c("MPIO_CCNCT"="Depmun")) %>%
filter(Region=="Región Llano")
box <- st_bbox(Llano)
ggplot() +
geom_sf(data=Llano,aes(fill=Irural),col="darkgray",linetype="solid") +
geom_sf(data=deptoshp,alpha=0.1,col="black") +
coord_sf(xlim=c(box$xmin,box$xmax),ylim=c(box$ymin,box$ymax),expand=FALSE) +
geom_sf_text(data=Llano,aes(label=ifelse(Irural > 85,Municipio,"")),col="black",
fontface="bold",size=3.5,fun.geometry=function(x) sf::st_centroid(x)) +
labs(x="Longitud",y="Latitud",title="Región Llano",fill="Índice de\nRuralidad") +
scale_fill_gradient(low="white",high="red",n.breaks=5)
###Boyacá Estaciones de Monitoreo Precipitación ----
library(stringr)
Estaciones <- read_excel("Estaciones.xlsx")
Estaciones <- within(Estaciones,Depmun <- stringr::str_sub(Depmun,1,5))
View(Estaciones)
poligonos <- mpioshp %>% filter(DPTO_CCDGO %in% c("15"))
Ests <- Estaciones %>% filter(str_sub(Depmun,1,2) %in% c("15"))
Deps <- unique(poligonos$DPTO_CNMBR)
ggplot(Ests) +
geom_sf(data=poligonos,fill="orange",col="black",linetype="solid") +
geom_point(aes(x=longitud,y=latitud,size=PRECIP),col="blue") +
scale_size(range=c(0,5)) +
labs(x="Longitud",y="Latitud",title=ifelse(length(Deps)==1,Deps,paste0(Deps,collapse=" y ")),
size="Precipitación") +
coord_sf(default_crs = sf::st_crs(4326))
View(Ocupados_ENH)
